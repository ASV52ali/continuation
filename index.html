<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>FaceID Bale Sender</title>
<style>
body {
    font-family: sans-serif;
    text-align: center;
    background: #f2f2f2;
}
#video {
    width: 300px;
    border: 3px solid #333;
    border-radius: 10px;
}
button {
    padding: 10px 20px;
    font-size: 18px;
    margin-top: 15px;
}
#result {
    margin-top: 20px;
    font-size: 17px;
    padding: 10px;
    width: 300px;
    margin-left: auto;
    margin-right: auto;
    border-radius: 10px;
    background: white;
    box-shadow: 0 0 5px #aaa;
}
</style>
</head>
<body>

<h2>Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ø­Ø¶ÙˆØ± Ú†Ù‡Ø±Ù‡ â†’ Ø¨Ù„Ù‡</h2>

<video id="video" autoplay playsinline></video><br>
<button onclick="capture()">ðŸ“¸ Ø«Ø¨Øª Ùˆ Ø§Ø±Ø³Ø§Ù„</button>

<div id="result">Ù†ØªÛŒØ¬Ù‡ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</div>

<script>

const BOT_TOKEN = "ØªÙˆÚ©Ù†_ØªÙˆ_Ø§ÛŒÙ†Ø¬Ø§";
const CHAT_ID   = "Ú†Øª_Ø¢ÛŒØ¯ÛŒ_ØªÙˆ_Ø§ÛŒÙ†Ø¬Ø§";

navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => video.srcObject = stream)
  .catch(err => {
      document.getElementById("result").innerText = "â­• Ø§Ø¬Ø§Ø²Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯!";
  });

function capture() {
    document.getElementById("result").innerText = "â³ Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª Ø¹Ú©Ø³...";
    
    let video = document.getElementById('video');
    let canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    let ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0);

    canvas.toBlob(blob => {
        sendPhoto(blob);
    }, "image/jpeg", 0.85);
}

function sendPhoto(imageBlob) {

    document.getElementById("result").innerText = "ðŸ“¤ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¨Ù„Ù‡...";

    let formData = new FormData();
    formData.append("chat_id", CHAT_ID);
    formData.append("photo", imageBlob, "face.jpg");

    fetch(https://tapi.bale.ai/bot${BOT_TOKEN}/sendPhoto, {
        method: "POST",
        body: formData
    })
    .then(r => {
        if (r.ok) {
            document.getElementById("result").innerText = "âœ” Ø¹Ú©Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯";
            return r.text();
        } else {
            throw new Error("status: " + r.status);
        }
    })
    .catch(e => {
        document.getElementById("result").innerText =
            "âš  Ø¹Ú©Ø³ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ ÙˆÙ„ÛŒ Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ± Ù†Ø§Ù…Ø´Ø®Øµ Ø¨ÙˆØ¯";
    });
}

</script>

</body>
</html>
